# Introduction to SQL
Sql is a special purpose languase used to define, access, and manipulate data.
- Non procedural

**DDL** (Data definition Language)

**DML** (Data manipulation language)
    - Insert
    -Update
    -Delete
    -Merge
    -Select

We will focus on **Data Manipulation Language**


## DML Statements

### Select
The select statement is used to retreive data.
```sql
SELECT <one or more things>
FROM <one or more places>
WHERE <zero, one, or more conditions apply>
```

#### Select clause elements
You can not only select columns from tables but also:
-Literal values, such numbers(27)
-Expressions, e.g. shape.diameter*3.1416
-Functions calls, e.g. TO_DATE('01-JAN-2004', 'DD-MON-YYYY')
-Pseudocolumns such as ROWID, ROWNUM or LEVEL


#### Ordering your results
If you want your results to be sorted by one or more columns, you can add an `ORDER BY` clause after the `WHERE` clause.

You can also sort the column(s) by the position in the select  clause.
Example:
```sql
SELECT field1, field2, field3
FROM table t
SORT BY 1
--table will be sort by field 1
```

#### Removing duplicates
To remove duplicates you can use the DISTINCT keyword in your SELECT clause, as in:
Keep in mind that deleting duplicates necessitates a sort operation, which can greatly increase the execution time of your query.
```sql
SELECT DISTINCT li.part_nbr
from cust_order co inner join line_item li
ON co.order_nbr = li.order_nbr
WHERE co.order_dt >= TO_DATE('01-JUL-2001', 'DD-MON-YYYY')
AND co.order_dt < TO_DATE('01-AUG-2001','DD-MON-YYYY');

```

### INSERT Statement
The `INSERT` statement is a mechanism to insert data into only one table.
When inserting, you don't need to provide values for every column unless the column requieres non-null values.

Example: 
```sql
INSERT INTO employee(emp_id, dept_id)
VALUES(101,20);


INSERT INTO employee(emp_id,lname, dept_id)
VALUES(103,'Nerio',20);
```

The VALUES clause must contain the same number of elements as the column list, data types also must match.

You can insert data retreived from one or more tables
Example:

```sql
INSERT INTO employee (emp_id, fname, lname, dept_id,hire_date)
SELECT 105,'Luis', 'Nerio', d.dept_id, SYSDATE
FROM department d
where d.name = 'ACCOUNTING'

```

#### Multitable inserts
You can insert complex data insertion with a single insert:

```sql
INSERT ALL 
INTO cust_order( order_nbr, cust_nbr, sales_emp_id, order_dt, expected_ship_dt, status)
VALUES(order_nbr, cust_nbr, sales_emp_id, ord_dt, ord_dt+7, status)
INTO cust_order (order_nbr, cust_nbr, sales_emp_id, order_dt, expected_ship_dt, status)
VALUES (order_nbr + 1, cust_nbr, sales_emp_id, add_months(ord_dt, 1), add_months(ord_dt, 1) + 7, status)
INTO cust_order (order_nbr, cust_nbr, sales_emp_id, order_dt, expected_ship_dt, status)
VALUES (order_nbr + 2, cust_nbr, sales_emp_id, add_months(ord_dt, 2), add_months(ord_dt, 2) + 7, status)
INTO cust_order (order_nbr, cust_nbr, sales_emp_id, order_dt, expected_ship_dt, status)
VALUES (order_nbr + 3, cust_nbr, sales_emp_id, add_months(ord_dt, 3), add_months(ord_dt, 3) + 7, status)
INTO cust_order (order_nbr, cust_nbr, sales_emp_id, order_dt, expected_ship_dt, status)
VALUES (order_nbr + 4, cust_nbr, sales_emp_id, add_months(ord_dt, 4), add_months(ord_dt, 4) + 7, status)
INTO cust_order (order_nbr, cust_nbr, sales_emp_id, order_dt, expected_ship_dt, status)
VALUES (order_nbr + 5, cust_nbr, sales_emp_id, add_months(ord_dt, 5), add_months(ord_dt, 5) + 7, status)
SELECT 99990 order_nbr, c.cust_nbr cust_nbr, e.emp_id sales_emp_id, last_day(SYSDATE) ord_dt, 'PENDING' status
FROM customer c CROSS JOIN employee e WHERE e.FNAME = 'MARY' AND e.lname = 'TURNER' AND c.name = 'Gentech Industries';
```


You are not obligated to inser all row into the same table, nor must your `SELECT` statement return onlyu one row, example:


```sql

INSERT ALL 
INTO employee (emp_id, fname, lname, dept_id, hire_date)
VALUES (eid, fnm, lnm,did, TRUNC(SYSDATE))
INTO salesperson(salesperson_id,name, primary_region_id)
VALUES (eid, fnm||' ' || lnm, rid)
SELECT 1001 eid, 'Enrique' fnm,  'LOPEZ' lnm, d.dept_id did, r.region_id rid
FROM department d, region r WHERE d.name = 'SALES' and r.name = 'Southeast US'
```


So far you have seen how to make multiple inserts on one table, insert into multiple tables from the same row, now you will see how a conditional clause can be used to direct each row of data generated by the select clause into zero, one or many tables:


```sql
INSERT FIRST
    WHEN order_dt < TO_DATE( '2001-01-01','YYYY-MM-DD') THEN
    INTO cust_order_2000(order_nbr, cust_nbr, sales_emp_id, sale_price,order_dt,expected_ship_dt)
    VALUES (order_nbr, cust_nbr, sales_emp_id,sale_price, order_dt,expected_ship_dt)
    WHEN order_dt < TO_DATE( '2002-01-01','YYYY-MM-DD') THEN
    INTO cust_order_2001(order_nbr, cust_nbr, sales_emp_id, sale_price,order_dt,expected_ship_dt)
    VALUES (order_nbr, cust_nbr, sales_emp_id,sale_price, order_dt,expected_ship_dt)
    WHEN order_dt < TO_DATE( '2003-01-01','YYYY-MM-DD') THEN
    INTO cust_order_2002(order_nbr, cust_nbr, sales_emp_id, sale_price,order_dt,expected_ship_dt)
    VALUES (order_nbr, cust_nbr, sales_emp_id,sale_price, order_dt,expected_ship_dt)
SELECT co.order_nbr, co.cust_nbr, co.sales_emp_id,co.sale_price, co.order_dt,co.expected_ship_dt
from cust_order co
WHERE co.cancelled_dt is NULL;
```

It's important that `INSERT FIRST` executes the comparison for each row on the `SELECT` statement and the momment it meets the criteria, it insert and skip to the next row. If you specify `ALL` instead, then the all conditions will be executed and each row might be inserted on multiple tables.

### The DELETE statement

The `DELETE` statement facilitates the removal of data, like the `SELECT` statement it has a `WHERE` clause to specify the condition of the delete.
Be careful if you user `DELETE` without `WHERE` conditions, all rows from the table will be removed.

```sql
DELETE FROM employee where lname = 'GALLEGOS';
```
 

 You can use `DELETE` but with condition contained in another table:


 ```sql
DELETE FROM employee 
WHERE dept_id =
(SELECT dept_id from department where name = 'ACCOUNTING');
 ```

The use of the `SELECT` statement on the previous example is called a **SUBQUERY**

In some cases you may want to restrict the number of rows deleted, the pseucolumn `ROWNUM` comes into play, for example delete rows on batches of 10000 rows:

```sql
DELETE FROM employee WHERE ROWNUM  <=10000;
COMMIT
```


### The UPDATE statement
Modifications are handle by the `UPDATE` statement, this statement also includes a `WHERE` clause to specify the conditions of the rows you want to `UPDATE`.
The following example show the update on the `employee` table, we will raise the salary for all the employees that have a salary less than 40,000:

```sql

UPDATE employee
SET salary = salary*1.10
WHERE salary<40000
```

If you want to update more than one columns theres two ways to do it:
-Provide a set of column/value pairs separated by commas 
-Provide a set of columns and a subquery:


```sql
UPTDATE customer
SET inactive_dt = SYSDATE, inactive_ind = 'Y'
WHERE last_order_dt < TO_DATE('2000-06-01', 'YYYY-MM-DD');

UPDATE customer 
SET (inactive_dt, inactive_ind)= (SELECT SYSDATE, 'Y' from DUAL) 
WHERE last_order_dt < TO_DATE('2000-06-01', 'YYYY-MM-DD')

```


### The MERGE statement
There are certain situations, where you want to either insert or update new data depending if data already exist.

While you could write code that reads each record from the feed, determines wheter or not the part number exists in the part table, and issues either an `INSERT` or a `UPDATE`, you could instead issue a single `MERGE` statement.

Assuming your data feed has been loaded on the staing table `part_stg`, your `MERGE`  statement would loook like thse

```sql

MERGE INTO part p_dest
USING part_stg p_src
ON (p_dest.part_nbr=p.src.part_nbr)
WHEN MATCHED THEN UPDATE
    SET p_dest.unit_cost = p_src.unit_cost, p_dest.status = p_src.status

WHEN NOT MATCHED THEN INSERT (p_dest.part_nbr, p_dest.name,p_dest.supplier_id, p_dest.status, p_dest.inventory_qty,p_dest.unit_cost, p_dest.resupply_date )
VALUES (p_src.part_nbr, p_src.name, p_src.supplier_id, p_src.status,0, p_src.unit_cost,null); 
```

## Why are there more 17 chapters
There are multiple ways to arrive to the same result, some are more efficient.
The goal is that you don't have to come back to the stuff you wrote the previous year, recode it, just from the get go know what you need and just write it.


